---
title: "æ·±ã„ãƒã‚¹ãƒˆã¯è¨­è¨ˆã®æ•—åŒ—ï¼šãƒ•ãƒ©ãƒƒãƒˆãªJSON APIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã™ã™ã‚"
emoji: "ğŸ—ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["API", "JSON", "GraphQL", "REST", "ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"]
published: true
---

## ã¯ã˜ã‚ã«

APIã‚’è¨­è¨ˆã—ã¦ã„ã‚‹ã¨ã€ã¤ã„ã€Œä¾¿åˆ©ã ã‹ã‚‰ã€ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒã‚¹ãƒˆã•ã›ã¦ã—ã¾ã†ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ä¸­ã«æ³¨æ–‡å±¥æ­´ã€ãã®ä¸­ã«å•†å“æƒ…å ±ã€ãã®ä¸­ã«ã‚«ãƒ†ã‚´ãƒª...ã€‚æ°—ã¥ã‘ã°5éšå±¤ã€6éšå±¤ã®JSONã€‚

```json
{
  "user": {
    "id": 1,
    "name": "ç”°ä¸­å¤ªéƒ",
    "orders": [
      {
        "id": 101,
        "items": [
          {
            "product": {
              "id": 201,
              "name": "å•†å“A",
              "category": {
                "id": 301,
                "name": "ã‚«ãƒ†ã‚´ãƒªX",
                "parent": {
                  "id": 300,
                  "name": "è¦ªã‚«ãƒ†ã‚´ãƒª"
                }
              }
            }
          }
        ]
      }
    ]
  }
}
```

ã“ã‚Œã¯**è¨­è¨ˆã®æ•—åŒ—**ã ã€‚ãªãœã‹ã€‚ãã—ã¦ã©ã†ã™ã¹ãã‹ã€‚

## æ·±ã„ãƒã‚¹ãƒˆã®å•é¡Œç‚¹

### 1. è²¬å‹™ã®å¢ƒç•ŒãŒæ›–æ˜§ã«ãªã‚‹

ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€è¦ªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã€Œæ‰€æœ‰ã€ã•ã‚Œã‚‹ã€‚ä¸Šã®ä¾‹ã§ `category` ã¯ `product` ã®ä¸€éƒ¨ã¨ã—ã¦æ‰±ã‚ã‚Œã€`product` ã¯ `items` ã®ä¸€éƒ¨ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã€‚

ã ãŒå®Ÿéš›ã«ã¯ã€ã‚«ãƒ†ã‚´ãƒªã¯ã‚«ãƒ†ã‚´ãƒªã¨ã—ã¦ç‹¬ç«‹ã—ãŸå­˜åœ¨ã ã€‚å•†å“ã¨ã¯åˆ¥ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’æŒã¡ã€åˆ¥ã®ãƒãƒ¼ãƒ ãŒç®¡ç†ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚**ãƒã‚¹ãƒˆã¯ã€ã“ã®ç‹¬ç«‹æ€§ã‚’è¦†ã„éš ã—ã¦ã—ã¾ã†**ã€‚

### 2. ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡

åŒã˜ã‚«ãƒ†ã‚´ãƒªã«å±ã™ã‚‹å•†å“ãŒ10å€‹ã‚ã‚Œã°ã€åŒã˜ã‚«ãƒ†ã‚´ãƒªæƒ…å ±ãŒ10å›ç¹°ã‚Šè¿”ã•ã‚Œã‚‹ã€‚

```json
{
  "items": [
    { "product": { "category": { "id": 301, "name": "ã‚«ãƒ†ã‚´ãƒªX" } } },
    { "product": { "category": { "id": 301, "name": "ã‚«ãƒ†ã‚´ãƒªX" } } },
    { "product": { "category": { "id": 301, "name": "ã‚«ãƒ†ã‚´ãƒªX" } } }
    // åŒã˜æƒ…å ±ãŒå»¶ã€…ã¨...
  ]
}
```

å¸¯åŸŸã®ç„¡é§„ã ã‘ã§ãªãã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ–ã‚‚å¿…è¦ã«ãªã‚‹ã€‚

### 3. å¾ªç’°å‚ç…§ã®åœ°ç„

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ³¨æ–‡ã‚’æŒã¡ã€æ³¨æ–‡ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‚ç…§ã™ã‚‹ã€‚ã©ã“ã‹ã§åˆ‡ã‚‰ãªã„ã¨ç„¡é™ãƒ«ãƒ¼ãƒ—ã«ãªã‚‹ã€‚

```json
{
  "user": {
    "orders": [
      {
        "user": {  // ã¾ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼Ÿã©ã“ã¾ã§å±•é–‹ã™ã‚‹ï¼Ÿ
          "orders": [ ... ]
        }
      }
    ]
  }
}
```

å®Ÿè£…è€…ã¯ã€Œã“ã“ã¯å±•é–‹ã—ãªã„ã€ã€Œã“ã“ã¯IDã ã‘ã€ã¨å ´å½“ãŸã‚Šçš„ã«æ±ºã‚ã‚‹ã€‚ä¸€è²«æ€§ãŒãªããªã‚‹ã€‚

### 4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®é¸æŠè‚¢ã‚’å¥ªã†

æ·±ããƒã‚¹ãƒˆã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã€Œå…¨éƒ¨å—ã‘å–ã‚Œã€ã¨å¼·åˆ¶ã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼åã ã‘æ¬²ã—ã„å ´åˆã§ã‚‚ã€æ³¨æ–‡å±¥æ­´ã‹ã‚‰å•†å“æƒ…å ±ã¾ã§å…¨éƒ¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã‚‰ã‚Œã‚‹ã€‚

## GraphQLã¯è§£æ±ºç­–ã‹ï¼Ÿ

ã€Œãã‚Œãªã‚‰GraphQLã‚’ä½¿ãˆã°ã„ã„ã€ã¨ã„ã†å£°ãŒèã“ãˆã¦ããã†ã ã€‚ç¢ºã‹ã«GraphQLã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã ã‘ã‚’æŒ‡å®šã§ãã‚‹ã€‚

```graphql
query {
  user(id: 1) {
    name
    orders {
      items {
        product {
          name
        }
      }
    }
  }
}
```

ã—ã‹ã—ã€**GraphQLã¯æ·±ã„ãƒã‚¹ãƒˆã‚’è¨±å®¹ã—ã¦ã—ã¾ã†ç‚¹ã§å•é¡Œã‚’è§£æ±ºã—ã¦ã„ãªã„**ã€‚ã‚€ã—ã‚æ‚ªåŒ–ã•ã›ã‚‹å ´åˆã‚‚ã‚ã‚‹ã€‚

### GraphQLã®åŠŸç¸¾

1. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸»å°ã®ãƒ‡ãƒ¼ã‚¿å–å¾—**: å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã ã‘å–å¾—ã§ãã‚‹
2. **å‹ã‚·ã‚¹ãƒ†ãƒ **: ã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹æ˜ç¢ºãªå¥‘ç´„
3. **å˜ä¸€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: è¤‡æ•°ãƒªã‚½ãƒ¼ã‚¹ã‚’1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å–å¾—

### GraphQLã®ç½ª

1. **N+1å•é¡Œã®èª˜ç™º**: æ·±ã„ãƒã‚¹ãƒˆã¯è‡ªç„¶ã¨N+1ã‚¯ã‚¨ãƒªã‚’ç”Ÿã‚€
2. **è¤‡é›‘ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥**: RESTã®HTTPã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒä½¿ãˆãªã„
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯**: æ‚ªæ„ã‚ã‚‹ã‚¯ã‚¨ãƒªã§æ·±ã„ãƒã‚¹ãƒˆã‚’è¦æ±‚ã•ã‚Œã‚‹
4. **è²¬å‹™ã®æ›–æ˜§åŒ–**: ã‚¹ã‚­ãƒ¼ãƒãŒå·¨å¤§åŒ–ã—ã€å¢ƒç•ŒãŒè¦‹ãˆãªããªã‚‹

ç‰¹ã«å•é¡Œãªã®ã¯ã€**GraphQLãŒãƒã‚¹ãƒˆã‚’ã€Œæ©Ÿèƒ½ã€ã¨ã—ã¦æä¾›ã—ã¦ã„ã‚‹**ã“ã¨ã€‚é–‹ç™ºè€…ã¯ã¤ã„ä½¿ã£ã¦ã—ã¾ã†ã€‚

```graphql
# ã“ã‚“ãªã‚¯ã‚¨ãƒªãŒæ›¸ã‘ã¦ã—ã¾ã†
query {
  user {
    friends {
      friends {
        friends {
          posts {
            comments {
              author {
                friends { ... }
              }
            }
          }
        }
      }
    }
  }
}
```

## ãƒ•ãƒ©ãƒƒãƒˆãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã„ã†è§£

ã§ã¯ã©ã†ã™ã¹ãã‹ã€‚ç­”ãˆã¯**ãƒ•ãƒ©ãƒƒãƒˆãªæ§‹é€ **ã ã€‚

### æ­£è¦åŒ–ã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹

JSON:APIä»•æ§˜ã‚„Reduxã®æ­£è¦åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å€£ã„ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ãƒ©ãƒƒãƒˆã«é…ç½®ã™ã‚‹ã€‚

```json
{
  "data": {
    "type": "user",
    "id": "1",
    "attributes": {
      "name": "ç”°ä¸­å¤ªéƒ"
    },
    "relationships": {
      "orders": {
        "data": [
          { "type": "order", "id": "101" }
        ]
      }
    }
  },
  "included": [
    {
      "type": "order",
      "id": "101",
      "attributes": {
        "total": 5000
      },
      "relationships": {
        "items": {
          "data": [
            { "type": "item", "id": "1001" }
          ]
        }
      }
    },
    {
      "type": "item",
      "id": "1001",
      "relationships": {
        "product": {
          "data": { "type": "product", "id": "201" }
        }
      }
    },
    {
      "type": "product",
      "id": "201",
      "attributes": {
        "name": "å•†å“A"
      },
      "relationships": {
        "category": {
          "data": { "type": "category", "id": "301" }
        }
      }
    },
    {
      "type": "category",
      "id": "301",
      "attributes": {
        "name": "ã‚«ãƒ†ã‚´ãƒªX"
      }
    }
  ]
}
```

### ãƒ•ãƒ©ãƒƒãƒˆæ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ

#### 1. è²¬å‹™ã®æ˜ç¢ºåŒ–

å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç‹¬ç«‹ã—ã¦ã„ã‚‹ã€‚`category` ã¯ `product` ã®ã€Œå­ã€ã§ã¯ãªãã€ç‹¬ç«‹ã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã—ã¦å­˜åœ¨ã™ã‚‹ã€‚

```
user â”€â”€referencesâ”€â”€> order
order â”€â”€referencesâ”€â”€> item
item â”€â”€referencesâ”€â”€> product
product â”€â”€referencesâ”€â”€> category
```

ã“ã‚Œã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨åŒã˜ã ã€‚æ­£è¦åŒ–ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ãŒãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§çµã°ã‚Œã¦ã„ã‚‹ã€‚

#### 2. é‡è¤‡ã®æ’é™¤

åŒã˜ã‚«ãƒ†ã‚´ãƒªã¯1å›ã ã‘è¿”ã•ã‚Œã‚‹ã€‚

```json
{
  "included": [
    { "type": "category", "id": "301", "attributes": { "name": "ã‚«ãƒ†ã‚´ãƒªX" } }
    // 1å›ã ã‘ï¼
  ]
}
```

10å€‹ã®å•†å“ãŒåŒã˜ã‚«ãƒ†ã‚´ãƒªã§ã‚‚ã€ã‚«ãƒ†ã‚´ãƒªæƒ…å ±ã¯1ã¤ã€‚

#### 3. å¾ªç’°å‚ç…§ã®è§£æ±º

IDã§å‚ç…§ã™ã‚‹ã ã‘ãªã®ã§ã€å¾ªç’°ã—ã¦ã‚‚å•é¡Œãªã„ã€‚

```json
{
  "included": [
    {
      "type": "order",
      "id": "101",
      "relationships": {
        "user": { "data": { "type": "user", "id": "1" } }
      }
    },
    {
      "type": "user",
      "id": "1",
      "relationships": {
        "orders": { "data": [{ "type": "order", "id": "101" }] }
      }
    }
  ]
}
```

å±•é–‹ã¯ä¸è¦ã€‚IDãŒã‚ã‚Œã°å‚ç…§ã§ãã‚‹ã€‚

#### 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åŠ¹ç‡åŒ–

å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç‹¬ç«‹ã—ã¦ã„ã‚‹ã®ã§ã€å€‹åˆ¥ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ãã‚‹ã€‚

```javascript
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
const cache = {
  user: { "1": { name: "ç”°ä¸­å¤ªéƒ" } },
  category: { "301": { name: "ã‚«ãƒ†ã‚´ãƒªX" } },
  product: { "201": { name: "å•†å“A" } }
};
```

ã‚«ãƒ†ã‚´ãƒªãŒæ›´æ–°ã•ã‚ŒãŸã‚‰ã€ã‚«ãƒ†ã‚´ãƒªã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã ã‘æ›´æ–°ã™ã‚Œã°ã„ã„ã€‚

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆRails + ActiveModelSerializersé¢¨ï¼‰

```ruby
class UserSerializer
  def serialize(user, includes: [])
    result = {
      data: {
        type: 'user',
        id: user.id.to_s,
        attributes: { name: user.name },
        relationships: {
          orders: {
            data: user.orders.map { |o| { type: 'order', id: o.id.to_s } }
          }
        }
      },
      included: []
    }

    if includes.include?(:orders)
      user.orders.each do |order|
        result[:included] << OrderSerializer.new.to_resource(order)
      end
    end

    # é‡è¤‡æ’é™¤
    result[:included].uniq! { |r| [r[:type], r[:id]] }
    result
  end
end
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆTypeScriptï¼‰

```typescript
interface NormalizedData {
  entities: {
    [type: string]: {
      [id: string]: Entity;
    };
  };
  result: { type: string; id: string };
}

function normalize(response: ApiResponse): NormalizedData {
  const entities: NormalizedData['entities'] = {};

  // ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
  const { type, id, attributes } = response.data;
  entities[type] = entities[type] || {};
  entities[type][id] = { id, ...attributes };

  // includedã‚’æ ¼ç´
  for (const item of response.included || []) {
    entities[item.type] = entities[item.type] || {};
    entities[item.type][item.id] = { id: item.id, ...item.attributes };
  }

  return { entities, result: { type, id } };
}

// ä½¿ç”¨ä¾‹
const data = normalize(apiResponse);
const user = data.entities.user["1"];
const category = data.entities.category["301"];
```

## ã„ã¤ãƒã‚¹ãƒˆã‚’ä½¿ã†ã¹ãã‹

ãƒ•ãƒ©ãƒƒãƒˆãŒå¸¸ã«æ­£è§£ã¨ã„ã†ã‚ã‘ã§ã¯ãªã„ã€‚ä»¥ä¸‹ã®å ´åˆã¯ãƒã‚¹ãƒˆã‚‚æ¤œè¨ã™ã‚‹ï¼š

1. **Value Object**: ä½æ‰€ã®ã‚ˆã†ã«ã€å˜ä½“ã§ã¯æ„å‘³ã‚’æŒãŸãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
2. **åŸ‹ã‚è¾¼ã¿ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: MongoDBã®ã‚ˆã†ã«ã€ä¸€ç·’ã«å–å¾—ãƒ»æ›´æ–°ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿
3. **é›†ç´„ãƒ«ãƒ¼ãƒˆå†…ã®å­ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£**: DDDã«ãŠã‘ã‚‹é›†ç´„å¢ƒç•Œå†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```json
{
  "user": {
    "address": {  // Value Object - ãƒã‚¹ãƒˆOK
      "prefecture": "æ±äº¬éƒ½",
      "city": "æ¸‹è°·åŒº"
    }
  }
}
```

## ã¾ã¨ã‚

| è¦³ç‚¹ | æ·±ã„ãƒã‚¹ãƒˆ | ãƒ•ãƒ©ãƒƒãƒˆæ§‹é€  |
|------|-----------|-------------|
| è²¬å‹™ã®å¢ƒç•Œ | æ›–æ˜§ | æ˜ç¢º |
| ãƒ‡ãƒ¼ã‚¿é‡è¤‡ | å¤šã„ | ãªã— |
| å¾ªç’°å‚ç…§ | å•é¡Œã«ãªã‚‹ | å•é¡Œãªã— |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | å›°é›£ | å®¹æ˜“ |
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£… | å˜ç´”ã ãŒéåŠ¹ç‡ | æ­£è¦åŒ–ãŒå¿…è¦ã ãŒåŠ¹ç‡çš„ |

**æ·±ã„ãƒã‚¹ãƒˆã¯ã€Œä¾¿åˆ©ã€ã®çš®ã‚’è¢«ã£ãŸæŠ€è¡“çš„è² å‚µ**ã ã€‚

GraphQLã‚’ä½¿ã†ãªã‚‰ã€æ·±ã•åˆ¶é™ã‚’è¨­ã‘ã‚ã€‚RESTã‚’ä½¿ã†ãªã‚‰ã€JSON:APIä»•æ§˜ã‚’æ¤œè¨ã—ã‚ã€‚ã©ã¡ã‚‰ã«ã›ã‚ˆã€**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ç‹¬ç«‹ã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã—ã¦æ‰±ãˆ**ã€‚

APIã¯å˜ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ã§ã¯ãªã„ã€‚ã‚·ã‚¹ãƒ†ãƒ ã®å¢ƒç•Œã‚’å®šç¾©ã™ã‚‹ã‚‚ã®ã ã€‚ãã®å¢ƒç•ŒãŒæ›–æ˜§ãªã‚‰ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãŒæ›–æ˜§ã«ãªã‚‹ã€‚

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [JSON:API Specification](https://jsonapi.org/)
- [Normalizing State Shape - Redux](https://redux.js.org/usage/structuring-reducers/normalizing-state-shape)
- [GraphQL Best Practices](https://graphql.org/learn/best-practices/)
